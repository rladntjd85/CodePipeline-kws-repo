<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <th:block layout:fragment="style">
		<link rel="stylesheet" th:href="@{/personnel/css/orgChart.css}" />
    </th:block>

</head>
<body>
<th:block layout:fragment="content">
    <!-- Begin Page Content -->
    <div class="container-fluid">
    	<!-- DataTales Example -->
		<div class="container-fluid">
			<section class="section">
				<div class="card shadow mb-4">
					<div class="card-header py-3">
						<h4 class="m-0 font-weight-bold">조직도</h4>
					</div>

					<!-- Content Area -->
					<div class="card-body">
						<div class="d-flex" style="gap: 20px;">
							<!-- 좌측 영역: 부서 목록 -->
							<div class="dept-list">
       							<select id="deptSelect">
       								<option value="">부서 선택</option>
           							<option th:each="dept : ${departments}"
                   							th:value="${dept.comDtId}"
                   							th:text="${dept.comDtNm}">
									</option>
      							 </select>
   							</div>

							<!-- 테이블 -->
							<div class="flex-grow-1 personnel-table-container">
								<table class="table table-bsordered">
									<thead>
										<tr class="empTable">
											<th>사원번호</th>
											<th>부서명</th>
											<th>직책</th>
											<th>이름</th>
											<th>전화번호</th>
											<th>이메일</th>
										</tr>
									</thead>
									<tbody id="empTableBody">
										<tr th:each="personnel : ${personnels}">
										    <td th:text="${personnel.empId}"></td>
										    <td th:text="${personnel.deptName}"></td>
										    <td th:text="${personnel.posName}"></td>
										    <td th:text="${personnel.name}"></td>
										    <td th:text="${personnel.phone}"></td>
										    <td th:text="${personnel.email}"></td>
										 </tr>					
									</tbody>
								</table>
							</div>
						</div>

						<!-- 페이지네이션 -->
						<section id="pageList"></section>
					</div>
				</div>
			</section>
		</div>
	</div>
</th:block>

<th:block layout:fragment="script">
	<script>
        document.addEventListener('DOMContentLoaded', function() {
            // 'deptSelect' id를 가진 <select> 요소를 찾음
            const deptSelect = document.getElementById('deptSelect');

            // 요소가 존재하면 change 이벤트 리스너를 추가
            if (deptSelect) {
                deptSelect.addEventListener('change', function() {
                    // 선택된 부서의 ID를 loadEmployees 함수에 전달
                    loadEmployees(this.value);
                });
            }
        });


        function loadEmployees(deptId) {
            fetch('/personnel/employees?deptId=' + deptId)
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('empTableBody');
                    tbody.innerHTML = '';
                    data.forEach(personnel => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${personnel.empId}</td>
                                <td>${personnel.deptName}</td>
                                <td>${personnel.posName}</td>
                                <td>${personnel.name}</td>
                                <td>${personnel.phone}</td>
                                <td>${personnel.email}</td>
                            </tr>
                        `;
                    });
                })
                .catch(error => console.error('Error fetching employees:', error));
        }
    </script>
</th:block>
</body>
</html>
